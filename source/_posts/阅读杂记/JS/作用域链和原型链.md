---
title: 作用域链和原型链
date: 2022-06-14 10:01:08
categories: 经验帖
tags:
    - JS基础
    - 杂记
summary: 作用域链是JS引擎查找变量的规则，原型链是JS引擎查找对象属性的规则
---

# 作用域链和原型链

## JS执行

JS是 __解释型语言__,边编译边执行.

JS执行 以 代码段 为单位,分为 三个阶段:__语法分析__ / __预编译阶段__ / __执行阶段__

代码段 有三种: 全局代码 函数代码 eval代码

## 语法分析

将代码分成 token,将 token解析成AST语法树(语法检查,报错)

分析该js脚本代码块的语法是否正确，如果出现不正确，则向外抛出一个语法错误（SyntaxError），停止该js代码块的执行，然后继续查找并加载下一个代码块

如果语法正确，则进入预编译阶段。

## 预编译阶段

### 执行上下文 执行上下文栈

每进入一个 代码段,便会创建相应的 __执行上下文__, 压入 __执行上下文栈__

__执行上下文__ 是一段代码时的运行环境，包括执行期间要用到的 __变量对象(Variable object)__ / __作用域链(Outer)__ / __This__

__执行上下文栈__  用来管理这些执行上下文，是一个 先进后出的 栈结构.

JS执行时首先会遇到全局代码，栈内压入 全局执行上下文.
然后执行到一个函数时，会 从 全局执行上下文 中取出这段函数的代码进行编译
创建该函数的执行上下文，又压入栈内.函数执行完毕，又弹出该执行上下文.

__执行上下文栈__ 其实就是 JavaScript 引擎追踪函数执行的一个机制

> 执行上下文栈,和函数执行时的变量查找没什么关系
> 代码段有 三种,执行上下文也是对应的三种 全局执行上下文 函数执行上下文 eval执行上下文

### 执行上下文的初始化

1. __作用域链（Scope Chain）__

复制函数 [[scope]] 属性创建作用域链

2. __变量对象（Variable Object）__

全局上下文 中 __全局对象(其window属性指向自己)__ 就是 __变量对象__ 

函数上下文 中 __活动对象(activation object, AO)__ 就是 __变量对象__

将 形参 函数声明 和 var变量 let/const变量 均作为 活动对象的属性名

| ---      | --- |  ---  |   ---      |
|形参       | 创建 | 初始化 | 并赋值实参  |
|函数声明    | 创建 | 初始化 | 并赋值函数体|
|var变量    | 创建 | 初始化 |            |
|let/const | 创建 |        |           |

let/const 创建了但是没有初始化,所以在赋值前被调用即报错 未初始化，__暂时性死区__

将 __变量对象__ 压入 __作用域链__ 顶端

__This__

## 执行阶段


__预处理(预编译)__ 

(局部预编译)
1. 创建一个Active Object对象

2.




3. __执行阶段__: 

JS是解释型语言,无需预先编译,原理是一边编译一边执行.

实际上JS执行 以代码块为单位(全局代码 函数代码 eval代码) 分为 编译阶段 和 执行阶段.

每当一个代码块被 调用,即 执行这两个阶段.

__编译阶段__

生成两部分, 作用域`[[Scope]]`, 可执行代码




__变量对象(Variable object，VO)__ 变量环境/词法环境 
## 作用域

__作用域__: 函数和变量的可访问的范围，生效范围 (全局作用域 函数作用域 块级作用域)

1.变量能够引用，函数能够生效的区域。
2.限制了你对内存空间上值的获取和修改。
3.JS引擎根据名称来查找变量的一套规则。
4.JS引擎通过查找作用域来解析标识符。

JS是 __词法作用域__ __静态作用域__,所以函数的作用域在函数定义的时候就确定了


## 感谢大佬

看了二十多篇文章,都快把我看蒙了,还是这四位最靠谱...

[吉古力 JS引擎线程的执行过程的三个阶段](https://www.jianshu.com/p/0972f9ed4a8c)

[冴羽 JavaScript深入之变量对象](https://github.com/mqyqingfeng/Blog/issues/5)

[[译] 理解 JavaScript 中的执行上下文和执行栈](https://juejin.cn/post/6844903682283143181)

[李兵《浏览器工作原理与实践》浏览器中的JavaScript执行机制](https://time.geekbang.org/column/article/119046)





[JavaScript中的预编译如何进行？看完这篇就够了](https://developer.51cto.com/article/659440.html)

[刻刻帝丶《JavaScript内部属性[[Scope]]与作用域链及其性能问题》](https://blog.csdn.net/q1056843325/article/details/53086893?locationNum=12&fps=1)

[孤岛浅滩《JS---[[scope]]/执行上下文/作用域/this》](https://blog.csdn.net/m0_37851778/article/details/75456954)

